<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunset Events - Organizer Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --deep-brown: #493129;
            --dusty-purple: #8b597b;
            --soft-pink: #efa3a0;
            --light-blue: #9ec8f9;
            --light-cream: #f9ecab;
        }

        body {
            background: linear-gradient(135deg, #fef9e7 0%, #fadbd8 100%);
            color: var(--deep-brown);
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--deep-brown) 0%, #5a3a3a 100%);
            color: white;
            padding: 25px 0;
            box-shadow: 5px 0 25px rgba(73, 49, 41, 0.2);
        }

        .logo {
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--soft-pink), var(--light-blue));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .logo span {
            color: var(--soft-pink);
        }

        .nav-links {
            list-style: none;
            padding: 0 15px;
        }

        .nav-links li {
            margin-bottom: 8px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-links a:hover, .nav-links a.active {
            background: linear-gradient(135deg, var(--dusty-purple), var(--soft-pink));
            color: white;
            transform: translateX(5px);
        }

        .nav-links i {
            margin-right: 15px;
            font-size: 18px;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(73, 49, 41, 0.08);
        }

        .header h2 {
            font-size: 28px;
            color: var(--deep-brown);
            font-weight: 700;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 12px 15px 12px 45px;
            border: 1px solid rgba(73, 49, 41, 0.2);
            border-radius: 30px;
            width: 280px;
            font-size: 14px;
        }

        .search-box i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--dusty-purple);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--soft-pink), var(--light-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(73, 49, 41, 0.08);
            transition: transform 0.3s ease;
            cursor: pointer;
            border-top: 5px solid;
        }

        .card:hover {
            transform: translateY(-8px);
        }

        .card.events { border-top-color: var(--deep-brown); }
        .card.tasks { border-top-color: var(--soft-pink); }
        .card.attendees { border-top-color: var(--dusty-purple); }
        .card.engagement { border-top-color: var(--light-blue); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header h3 {
            font-size: 16px;
            color: var(--deep-brown);
            font-weight: 600;
        }

        .stat {
            font-size: 36px;
            font-weight: 800;
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(135deg, var(--dusty-purple), var(--soft-pink));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 89, 123, 0.3);
        }

        .btn.delete {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            padding: 8px 12px;
            font-size: 12px;
        }

        .btn.delete:hover {
            background: linear-gradient(135deg, #ff3742, #ff2e3b);
            transform: translateY(-2px);
        }

        .feature-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(73, 49, 41, 0.08);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid rgba(73, 49, 41, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(73, 49, 41, 0.1);
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status.upcoming { background: rgba(139, 89, 123, 0.1); color: var(--dusty-purple); }
        .status.pending { background: rgba(249, 236, 171, 0.3); color: var(--deep-brown); }
        .status.in-progress { background: rgba(158, 200, 249, 0.3); color: var(--light-blue); }
        .status.completed { background: rgba(239, 163, 160, 0.2); color: var(--soft-pink); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(73, 49, 41, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 500px;
            max-width: 90%;
        }

        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--dusty-purple), var(--soft-pink));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(73, 49, 41, 0.2);
            border-radius: 8px;
            font-size: 16px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(73, 49, 41, 0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1100;
        }

        .toast.show {
            transform: translateX(0);
        }

        .spinner {
            border: 3px solid rgba(73, 49, 41, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--dusty-purple);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .event-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--dusty-purple);
            transition: transform 0.2s ease;
        }

        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(73, 49, 41, 0.1);
        }

        .question-item {
            background: rgba(249, 236, 171, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .meeting-item {
            background: rgba(139, 89, 123, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .sponsor-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(73, 49, 41, 0.08);
            border: 2px solid var(--light-cream);
        }

        .sponsor-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--soft-pink), var(--light-blue));
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }

        .create-event-form {
            background: rgba(249, 236, 171, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px dashed var(--dusty-purple);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-sunset"></i>
                </div>
                <h1>Sunset <span>Events</span></h1>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#" data-section="create-event"><i class="fas fa-calendar-plus"></i> Create Event</a></li>
                <li><a href="#" data-section="view-events"><i class="fas fa-list"></i> View Events</a></li>
                <li><a href="#" data-section="tasks"><i class="fas fa-tasks"></i> Vendor Tasks</a></li>
                <li><a href="#" data-section="meetings"><i class="fas fa-clock"></i> Schedule Meetings</a></li>
                <li><a href="#" data-section="questions"><i class="fas fa-question-circle"></i> Attendee Questions</a></li>
                <li><a href="#" data-section="sponsors"><i class="fas fa-star"></i> Sponsors</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="pageTitle">Event Organizer Dashboard</h2>
                <div class="header-actions">
                    
                    <div class="user-info">
                        <div class="user-avatar">OE</div>
                        <span>Organizer</span>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent">
                <div class="dashboard-cards">
                    <div class="card events">
                        <div class="card-header">
                            <h3>Total Events</h3>
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat" id="totalEvents">0</div>
                            <p>Loading events...</p>
                        </div>
                    </div>
                    <div class="card tasks">
                        <div class="card-header">
                            <h3>Vendor 1 Tasks</h3>
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat" id="totalTasks">0</div>
                            <p>Loading tasks...</p>
                        </div>
                    </div>
                    <div class="card attendees">
                        <div class="card-header">
                            <h3>Total Attendees</h3>
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat" id="totalAttendees">0</div>
                            <p>Across all events</p>
                        </div>
                    </div>
                    <div class="card engagement">
                        <div class="card-header">
                            <h3>Unanswered Questions</h3>
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat" id="totalQuestions">0</div>
                            <p>Requiring attention</p>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <div class="section-header">
                        <h3>Recent Events</h3>
                        <button class="btn" id="createEventBtn"><i class="fas fa-plus"></i> Create Event</button>
                    </div>
                    <div id="eventsList">
                        <div class="spinner"></div> Loading events from database...
                    </div>
                </div>

                <div class="feature-section">
                    <div class="section-header">
                        <h3>Vendor 1 Tasks</h3>
                        <button class="btn" id="createTaskBtn"><i class="fas fa-plus"></i> Create Task</button>
                    </div>
                    <div id="tasksList">
                        <div class="spinner"></div> Loading tasks from database...
                    </div>
                </div>

                <div class="feature-section">
                    <div class="section-header">
                        <h3>Recent Activity</h3>
                    </div>
                    <div id="activityList">
                        <div class="spinner"></div> Loading activity...
                    </div>
                </div>
            </div>

            <!-- Other Sections -->
            <div id="otherSections" style="display: none;"></div>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div class="modal" id="createEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Event</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Event Name *</label>
                    <input type="text" id="eventName" class="form-control" placeholder="Enter event name">
                </div>
                <div class="form-group">
                    <label>Event Date & Time *</label>
                    <input type="datetime-local" id="eventDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="eventDescription" class="form-control" rows="3" placeholder="Enter event description"></textarea>
                </div>
                <div class="form-group">
                    <label>Event Type *</label>
                    <select id="eventType" class="form-control">
                        <option value="">Select event type</option>
                        <option value="conference">Conference</option>
                        <option value="workshop">Workshop</option>
                        <option value="seminar">Seminar</option>
                        <option value="networking">Networking</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" id="eventLocation" class="form-control" placeholder="Enter event location" value="Virtual Event">
                </div>
                <div class="form-group">
                    <label>Zoom Meeting Link</label>
                    <input type="url" id="zoomLink" class="form-control" placeholder="https://zoom.us/j/5">
                </div>
                <button class="btn" id="saveEventBtn" style="width: 100%;">
                    <i class="fas fa-save"></i> Create Event
                </button>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div class="modal" id="createTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Task</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="taskTitle" class="form-control" placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="taskDescription" class="form-control" rows="3" placeholder="Enter task description"></textarea>
                </div>
                <div class="form-group">
                    <label>Due Date *</label>
                    <input type="datetime-local" id="taskDueDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="taskPriority" class="form-control">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <button class="btn" id="saveTaskBtn" style="width: 100%;">
                    <i class="fas fa-save"></i> Create Task for Vendor 1
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastMessage">Action completed!</span>
    </div>

    <script>
    const API_BASE_URL = 'https://gatherx-1vsr.onrender.com/api';

    // API service
    const apiService = {
        async getEvents() {
            try {
                const response = await fetch(`${API_BASE_URL}/events`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Events error:', error);
                throw error;
            }
        },

        async createEvent(eventData) {
            try {
                const response = await fetch(`${API_BASE_URL}/events`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(eventData)
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Create event error:', error);
                throw error;
            }
        },

        async deleteEvent(eventId) {
            try {
                const response = await fetch(`${API_BASE_URL}/events/${eventId}`, {
                    method: 'DELETE',
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Delete event error:', error);
                throw error;
            }
        },

        async getTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/tasks`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Tasks error:', error);
                throw error;
            }
        },

        async createTask(taskData) {
            try {
                const response = await fetch(`${API_BASE_URL}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(taskData)
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Create task error:', error);
                throw error;
            }
        },

        async getQuestions() {
            try {
                const response = await fetch(`${API_BASE_URL}/questions`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Questions error:', error);
                throw error;
            }
        },

        async answerQuestion(questionId, answerData) {
            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(answerData)
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Answer question error:', error);
                throw error;
            }
        }
    };

    // Global state
    let events = [];
    let tasks = [];
    let questions = [];

    // DOM elements
    const elements = {
        dashboardContent: document.getElementById('dashboardContent'),
        otherSections: document.getElementById('otherSections'),
        pageTitle: document.getElementById('pageTitle'),
        createEventBtn: document.getElementById('createEventBtn'),
        createTaskBtn: document.getElementById('createTaskBtn'),
        createEventModal: document.getElementById('createEventModal'),
        createTaskModal: document.getElementById('createTaskModal'),
        saveEventBtn: document.getElementById('saveEventBtn'),
        saveTaskBtn: document.getElementById('saveTaskBtn'),
        toast: document.getElementById('toast'),
        toastMessage: document.getElementById('toastMessage'),
        navLinks: document.querySelectorAll('.nav-links a')
    };

    // Initialize app
    async function initApp() {
        console.log('🚀 Initializing application...');
        
        try {
            showToast('Loading data from database...');
            
            // Load all data
            const [eventsData, tasksData, questionsData] = await Promise.all([
                apiService.getEvents().catch(error => {
                    console.error('Failed to load events:', error);
                    return [];
                }),
                apiService.getTasks().catch(error => {
                    console.error('Failed to load tasks:', error);
                    return [];
                }),
                apiService.getQuestions().catch(error => {
                    console.error('Failed to load questions:', error);
                    return [];
                })
            ]);

            // Store data
            events = Array.isArray(eventsData) ? eventsData : (eventsData.events || eventsData.data || []);
            tasks = Array.isArray(tasksData) ? tasksData : (tasksData.tasks || tasksData.data || []);
            questions = Array.isArray(questionsData) ? questionsData : (questionsData.questions || questionsData.data || []);

            updateDashboard();
            setupEventListeners();
            
            showToast('Dashboard loaded successfully!');

        } catch (error) {
            console.error('Initialization error:', error);
            showToast('Error loading dashboard', true);
        }
    }

    function updateDashboard() {
        // Update cards
        document.getElementById('totalEvents').textContent = events.length;
        
        const vendor1Tasks = tasks.filter(task => task.vendor === 'Vendor 1');
        document.getElementById('totalTasks').textContent = vendor1Tasks.length;
        
        const totalAttendees = events.reduce((sum, event) => sum + (event.attendees || 0), 0);
        document.getElementById('totalAttendees').textContent = totalAttendees;
        
        const unansweredQuestions = questions.filter(q => !q.answered);
        document.getElementById('totalQuestions').textContent = unansweredQuestions.length;

        // Update events list
        const eventsList = document.getElementById('eventsList');
        if (events.length === 0) {
            eventsList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                    <i class="fas fa-calendar-plus" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h3>No Events Yet</h3>
                    <p>Create your first event to get started!</p>
                </div>
            `;
        } else {
            eventsList.innerHTML = events.slice(0, 5).map(event => `
                <div class="event-card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h4 style="flex: 1;">${event.name}</h4>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span class="status ${event.status || 'upcoming'}">${event.status || 'Upcoming'}</span>
                            <button class="btn delete" onclick="deleteEvent('${event._id}', '${event.name}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                    <p style="color: var(--deep-brown); margin-bottom: 10px;">${event.description || 'No description'}</p>
                    <div style="display: flex; gap: 15px; font-size: 14px; color: var(--dusty-purple);">
                        <span><i class="fas fa-calendar"></i> ${new Date(event.date).toLocaleDateString()}</span>
                        <span><i class="fas fa-users"></i> ${event.attendees || 0} attendees</span>
                        ${event.zoomLink ? `<span><i class="fas fa-video"></i> Zoom meeting</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Update tasks list
        const tasksList = document.getElementById('tasksList');
        if (vendor1Tasks.length === 0) {
            tasksList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                    <i class="fas fa-tasks" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h3>No Tasks for Vendor 1</h3>
                    <p>Assign tasks to Vendor 1 to see them here.</p>
                </div>
            `;
        } else {
            tasksList.innerHTML = vendor1Tasks.slice(0, 5).map(task => `
                <div class="event-card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h4 style="flex: 1;">${task.title}</h4>
                        <span class="status ${task.status || 'pending'}">${task.status || 'Pending'}</span>
                    </div>
                    <p style="color: var(--deep-brown); margin-bottom: 10px;">${task.description || 'No description'}</p>
                    <div style="display: flex; gap: 15px; font-size: 14px; color: var(--dusty-purple);">
                        <span><i class="fas fa-clock"></i> Due: ${new Date(task.dueDate).toLocaleDateString()}</span>
                        <span><i class="fas fa-user-tag"></i> ${task.vendor}</span>
                        <span class="status ${task.priority || 'medium'}">${task.priority || 'Medium'} priority</span>
                    </div>
                </div>
            `).join('');
        }

        // Update activity list
        const activityList = document.getElementById('activityList');
        const recentActivity = [
            ...events.slice(0, 3).map(event => ({
                type: 'event',
                message: `Event "${event.name}" created`,
                date: event.date
            })),
            ...vendor1Tasks.slice(0, 2).map(task => ({
                type: 'task',
                message: `Task "${task.title}" assigned to Vendor 1`,
                date: task.dueDate
            }))
        ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);

        if (recentActivity.length === 0) {
            activityList.innerHTML = '<p>No recent activity</p>';
        } else {
            activityList.innerHTML = recentActivity.map(activity => `
                <div style="padding: 10px 0; border-bottom: 1px solid rgba(73, 49, 41, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${activity.type === 'event' ? 'calendar' : 'tasks'}" 
                           style="color: ${activity.type === 'event' ? 'var(--dusty-purple)' : 'var(--soft-pink)'};"></i>
                        <span>${activity.message}</span>
                    </div>
                    <small style="color: var(--dusty-purple); margin-left: 25px;">
                        ${new Date(activity.date).toLocaleDateString()}
                    </small>
                </div>
            `).join('');
        }
    }

    function showToast(message, isError = false) {
        elements.toastMessage.textContent = message;
        elements.toast.style.background = isError ? '#ffebee' : '#f3e5f5';
        elements.toast.style.borderLeft = isError ? '4px solid #ef5350' : '4px solid #7e57c2';
        elements.toast.classList.add('show');
        
        setTimeout(() => {
            elements.toast.classList.remove('show');
        }, 3000);
    }

    function setupEventListeners() {
        // Navigation
        elements.navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.getAttribute('data-section');
                
                elements.navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                if (section === 'dashboard') {
                    elements.dashboardContent.style.display = 'block';
                    elements.otherSections.style.display = 'none';
                    elements.pageTitle.textContent = 'Event Organizer Dashboard';
                } else {
                    elements.dashboardContent.style.display = 'none';
                    elements.otherSections.style.display = 'block';
                    elements.pageTitle.textContent = `${link.textContent.trim()} - Sunset Events`;
                    loadSection(section);
                }
            });
        });

        // Modal controls
        elements.createEventBtn.addEventListener('click', () => {
            elements.createEventModal.style.display = 'flex';
        });

        elements.createTaskBtn.addEventListener('click', () => {
            elements.createTaskModal.style.display = 'flex';
        });

        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                elements.createEventModal.style.display = 'none';
                elements.createTaskModal.style.display = 'none';
            });
        });

        // Save event
        elements.saveEventBtn.addEventListener('click', async () => {
            const eventData = {
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                description: document.getElementById('eventDescription').value,
                type: document.getElementById('eventType').value,
                location: document.getElementById('eventLocation').value,
                zoomLink: document.getElementById('zoomLink').value || '',
                attendees: 0,
                status: 'upcoming'
            };

            if (!eventData.name || !eventData.date || !eventData.description || !eventData.type || !eventData.location) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                elements.saveEventBtn.innerHTML = '<div class="spinner"></div> Creating...';
                elements.saveEventBtn.disabled = true;

                const newEvent = await apiService.createEvent(eventData);
                events.push(newEvent);
                
                updateDashboard();
                elements.createEventModal.style.display = 'none';
                
                // Clear form
                document.getElementById('eventName').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventDescription').value = '';
                document.getElementById('eventType').value = '';
                document.getElementById('eventLocation').value = 'Virtual Event';
                document.getElementById('zoomLink').value = '';
                
                showToast('Event created successfully!');
                
            } catch (error) {
                showToast('Error creating event: ' + error.message, true);
            } finally {
                elements.saveEventBtn.innerHTML = '<i class="fas fa-save"></i> Create Event';
                elements.saveEventBtn.disabled = false;
            }
        });

        // Save task
        elements.saveTaskBtn.addEventListener('click', async () => {
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                dueDate: document.getElementById('taskDueDate').value,
                priority: document.getElementById('taskPriority').value,
                vendor: 'Vendor 1',
                status: 'pending'
            };

            if (!taskData.title || !taskData.dueDate) {
                alert('Please fill in required fields');
                return;
            }

            try {
                elements.saveTaskBtn.innerHTML = '<div class="spinner"></div> Creating...';
                elements.saveTaskBtn.disabled = true;

                const newTask = await apiService.createTask(taskData);
                tasks.push(newTask);
                
                updateDashboard();
                elements.createTaskModal.style.display = 'none';
                
                // Clear form
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskDueDate').value = '';
                document.getElementById('taskPriority').value = 'medium';
                
                showToast('Task created successfully for Vendor 1!');
                
            } catch (error) {
                showToast('Error creating task: ' + error.message, true);
            } finally {
                elements.saveTaskBtn.innerHTML = '<i class="fas fa-save"></i> Create Task for Vendor 1';
                elements.saveTaskBtn.disabled = false;
            }
        });
    }

    async function loadSection(section) {
        elements.otherSections.innerHTML = `<div style="text-align: center; padding: 40px;"><div class="spinner"></div> Loading ${section} from database...</div>`;
        
        try {
            let content = '';
            
            switch(section) {
                case 'create-event':
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-calendar-plus"></i> Create New Event</h3>
                            </div>
                            
                            <div class="create-event-form">
                                <h4 style="margin-bottom: 20px; color: var(--deep-brown);">Event Creation Form</h4>
                                <div class="form-group">
                                    <label>Event Name *</label>
                                    <input type="text" id="sectionEventName" class="form-control" placeholder="Enter event name">
                                </div>
                                <div class="form-group">
                                    <label>Event Date & Time *</label>
                                    <input type="datetime-local" id="sectionEventDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Description *</label>
                                    <textarea id="sectionEventDescription" class="form-control" rows="3" placeholder="Enter event description"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Event Type *</label>
                                    <select id="sectionEventType" class="form-control">
                                        <option value="">Select event type</option>
                                        <option value="conference">Conference</option>
                                        <option value="workshop">Workshop</option>
                                        <option value="seminar">Seminar</option>
                                        <option value="networking">Networking</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Location *</label>
                                    <input type="text" id="sectionEventLocation" class="form-control" placeholder="Enter event location" value="Virtual Event">
                                </div>
                                <div class="form-group">
                                    <label>Zoom Meeting Link</label>
                                    <input type="url" id="sectionZoomLink" class="form-control" placeholder="https://zoom.us/j/5551112222">
                                </div>
                                <button class="btn" id="sectionSaveEventBtn" style="width: 100%;">
                                    <i class="fas fa-save"></i> Create Event
                                </button>
                            </div>

                            <div style="margin-top: 30px;">
                                <h4 style="margin-bottom: 15px; color: var(--deep-brown);">Recent Events (${events.length})</h4>
                                ${events.length === 0 ? `
                                    <p style="text-align: center; color: var(--dusty-purple); padding: 20px;">
                                        No events created yet. Use the form above to create your first event!
                                    </p>
                                ` : events.slice(0, 3).map(event => `
                                    <div class="event-card">
                                        <h5>${event.name}</h5>
                                        <p style="font-size: 14px; color: var(--deep-brown); margin: 5px 0;">${event.description}</p>
                                        <div style="font-size: 12px; color: var(--dusty-purple);">
                                            <span>${new Date(event.date).toLocaleDateString()} • ${event.type} • ${event.attendees || 0} attendees</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'view-events':
                    events = await apiService.getEvents();
                    events = Array.isArray(events) ? events : (events.events || events.data || []);
                    
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-list"></i> All Events (${events.length})</h3>
                            </div>
                            ${events.length === 0 ? `
                                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                                    <i class="fas fa-calendar-plus" style="font-size: 64px; margin-bottom: 20px;"></i>
                                    <h3>No Events in Database</h3>
                                    <p>Create your first event to get started!</p>
                                </div>
                            ` : events.map(event => `
                                <div class="event-card">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <h4 style="flex: 1;">${event.name}</h4>
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <span class="status ${event.status || 'upcoming'}">${event.status || 'Upcoming'}</span>
                                            <button class="btn delete" onclick="deleteEvent('${event._id}', '${event.name}')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </div>
                                    </div>
                                    <p style="color: var(--deep-brown); margin-bottom: 15px;">${event.description || 'No description'}</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 14px; color: var(--dusty-purple);">
                                        <div><i class="fas fa-calendar"></i> ${new Date(event.date).toLocaleString()}</div>
                                        <div><i class="fas fa-users"></i> ${event.attendees || 0} attendees</div>
                                        <div><i class="fas fa-tag"></i> ${event.type || 'No type'}</div>
                                        <div><i class="fas fa-map-marker"></i> ${event.location || 'Virtual'}</div>
                                        ${event.zoomLink ? `<div><i class="fas fa-video"></i> <a href="${event.zoomLink}" target="_blank">Join Meeting</a></div>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'tasks':
                    tasks = await apiService.getTasks();
                    tasks = Array.isArray(tasks) ? tasks : (tasks.tasks || tasks.data || []);
                    const vendor1Tasks = tasks.filter(task => task.vendor === 'Vendor 1');
                    
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-tasks"></i> Vendor 1 Tasks (${vendor1Tasks.length})</h3>
                            </div>
                            ${vendor1Tasks.length === 0 ? `
                                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                                    <i class="fas fa-tasks" style="font-size: 64px; margin-bottom: 20px;"></i>
                                    <h3>No Tasks for Vendor 1</h3>
                                    <p>Assign tasks to Vendor 1 to see them here.</p>
                                </div>
                            ` : `
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Task</th>
                                                <th>Description</th>
                                                <th>Due Date</th>
                                                <th>Priority</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${vendor1Tasks.map(task => `
                                                <tr>
                                                    <td><strong>${task.title}</strong></td>
                                                    <td>${task.description || 'No description'}</td>
                                                    <td>${new Date(task.dueDate).toLocaleString()}</td>
                                                    <td><span class="status ${task.priority || 'medium'}">${task.priority || 'Medium'}</span></td>
                                                    <td><span class="status ${task.status || 'pending'}">${task.status || 'Pending'}</span></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>
                    `;
                    break;
                    
                case 'questions':
                    questions = await apiService.getQuestions();
                    questions = Array.isArray(questions) ? questions : (questions.questions || questions.data || []);
                    const unansweredQuestions = questions.filter(q => !q.answered);
                    
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-question-circle"></i> Attendee Questions</h3>
                                <span class="status ${unansweredQuestions.length > 0 ? 'pending' : 'completed'}">
                                    ${unansweredQuestions.length} unanswered
                                </span>
                            </div>
                            ${questions.length === 0 ? `
                                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                                    <i class="fas fa-question-circle" style="font-size: 64px; margin-bottom: 20px;"></i>
                                    <h3>No Questions Yet</h3>
                                    <p>Attendee questions will appear here when they ask them.</p>
                                </div>
                            ` : questions.map(question => `
                                <div class="question-item" style="background: ${question.answered ? '#f0f8f0' : '#fff3e0'};">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <strong>${question.attendeeName || 'Anonymous'} - ${question.eventName || 'General'}</strong>
                                        <span class="status ${question.answered ? 'completed' : 'pending'}">
                                            ${question.answered ? 'Answered' : 'Unanswered'}
                                        </span>
                                    </div>
                                    <p><strong>Q:</strong> ${question.question}</p>
                                    ${question.answered ? `
                                        <p style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                                            <strong>A:</strong> ${question.answer}
                                        </p>
                                    ` : `
                                        <div style="margin-top: 10px;">
                                            <textarea id="answer-${question._id}" class="form-control" placeholder="Type your answer here..." rows="2"></textarea>
                                            <button class="btn" onclick="answerQuestion('${question._id}')" style="margin-top: 10px;">
                                                <i class="fas fa-paper-plane"></i> Send Answer
                                            </button>
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'sponsors':
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-star"></i> Sponsors</h3>
                            </div>
                            
                            <div style="display: flex; justify-content: center;">
                                <div class="sponsor-card" style="max-width: 400px;">
                                    <div class="sponsor-logo">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <h3 style="color: var(--deep-brown); margin-bottom: 15px;">Sponsor 1</h3>
                                    <div style="margin-bottom: 20px;">
                                        <span class="status" style="background: gold; color: #856404; padding: 8px 16px; font-size: 14px;">
                                            <i class="fas fa-crown"></i> Gold Tier Sponsor
                                        </span>
                                    </div>
                                    <div style="text-align: left; margin-bottom: 25px;">
                                        <div style="margin-bottom: 10px;">
                                            <i class="fas fa-envelope" style="color: var(--dusty-purple); width: 20px;"></i>
                                            <span>contact@sponsor1.com</span>
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <i class="fas fa-phone" style="color: var(--dusty-purple); width: 20px;"></i>
                                            <span>+1 (555) 123-4567</span>
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <i class="fas fa-globe" style="color: var(--dusty-purple); width: 20px;"></i>
                                            <a href="https://sponsor1.com" target="_blank" style="color: var(--light-blue);">www.sponsor1.com</a>
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <button class="btn" onclick="contactSponsor()">
                                            <i class="fas fa-envelope"></i> Contact Sponsor
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'meetings':
                    const eventsWithZoom = events.filter(event => event.zoomLink);
                    
                    content = `
                        <div class="feature-section">
                            <div class="section-header">
                                <h3><i class="fas fa-clock"></i> Scheduled Meetings & Zoom Links</h3>
                            </div>
                            
                            ${eventsWithZoom.length === 0 ? `
                                <div style="text-align: center; padding: 40px; color: var(--dusty-purple);">
                                    <i class="fas fa-video" style="font-size: 64px; margin-bottom: 20px;"></i>
                                    <h3>No Meetings with Zoom Links</h3>
                                    <p>Create events with Zoom links to see them here.</p>
                                </div>
                            ` : `
                                <div style="margin-bottom: 20px;">
                                    <p>These are the Zoom meeting links from your created events. Click any link to join the meeting.</p>
                                </div>
                                ${eventsWithZoom.map(event => `
                                    <div class="meeting-item">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                            <h4 style="flex: 1;">${event.name}</h4>
                                            <span class="status ${event.status || 'upcoming'}">${event.status || 'Upcoming'}</span>
                                        </div>
                                        <p style="color: var(--deep-brown); margin-bottom: 10px;">${event.description || 'No description'}</p>
                                        <div style="margin-bottom: 15px;">
                                            <strong>Zoom Meeting Link:</strong>
                                            <div style="margin-top: 5px;">
                                                <a href="${event.zoomLink}" target="_blank" 
                                                   style="color: var(--light-blue); word-break: break-all; display: block; padding: 10px; background: rgba(158, 200, 249, 0.1); border-radius: 6px;">
                                                    <i class="fas fa-external-link-alt"></i> ${event.zoomLink}
                                                </a>
                                            </div>
                                        </div>
                                        <div class="action-buttons">
                                            <button class="btn" onclick="window.open('${event.zoomLink}', '_blank')">
                                                <i class="fas fa-video"></i> Join Meeting
                                            </button>
                                            <button class="btn" onclick="copyToClipboard('${event.zoomLink}')">
                                                <i class="fas fa-copy"></i> Copy Link
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            `}
                        </div>
                    `;
                    break;
                    
                default:
                    content = `<div class="feature-section"><h3>${section}</h3><p>Loading content from database...</p></div>`;
            }
            
            elements.otherSections.innerHTML = content;
            
            // Setup event listeners for dynamically created elements
            if (section === 'create-event') {
                setupCreateEventSection();
            }
            
        } catch (error) {
            elements.otherSections.innerHTML = `
                <div class="feature-section">
                    <h3>Error Loading Section</h3>
                    <p>Failed to load data from database: ${error.message}</p>
                </div>
            `;
        }
    }

    // Setup create event section form
    function setupCreateEventSection() {
        const saveBtn = document.getElementById('sectionSaveEventBtn');
        if (saveBtn) {
            saveBtn.addEventListener('click', async () => {
                const eventData = {
                    name: document.getElementById('sectionEventName').value,
                    date: document.getElementById('sectionEventDate').value,
                    description: document.getElementById('sectionEventDescription').value,
                    type: document.getElementById('sectionEventType').value,
                    location: document.getElementById('sectionEventLocation').value,
                    zoomLink: document.getElementById('sectionZoomLink').value || '',
                    attendees: 0,
                    status: 'upcoming'
                };

                if (!eventData.name || !eventData.date || !eventData.description || !eventData.type || !eventData.location) {
                    alert('Please fill in all required fields');
                    return;
                }

                try {
                    saveBtn.innerHTML = '<div class="spinner"></div> Creating...';
                    saveBtn.disabled = true;

                    const newEvent = await apiService.createEvent(eventData);
                    events.push(newEvent);
                    
                    // Update dashboard and reload the create-event section to show new event
                    updateDashboard();
                    loadSection('create-event');
                    
                    // Clear form
                    document.getElementById('sectionEventName').value = '';
                    document.getElementById('sectionEventDate').value = '';
                    document.getElementById('sectionEventDescription').value = '';
                    document.getElementById('sectionEventType').value = '';
                    document.getElementById('sectionEventLocation').value = 'Virtual Event';
                    document.getElementById('sectionZoomLink').value = '';
                    
                    showToast('Event created successfully in database!');
                    
                } catch (error) {
                    showToast('Error creating event: ' + error.message, true);
                } finally {
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Create Event';
                    saveBtn.disabled = false;
                }
            });
        }
    }

    // Global functions
    window.deleteEvent = async function(eventId, eventName = '') {
        // Confirm deletion
        const confirmDelete = confirm(`Are you sure you want to delete "${eventName || 'this event'}"? This action cannot be undone.`);
        
        if (!confirmDelete) return;
        
        try {
            // Show loading state
            showToast('Deleting event...');
            
            // Call the delete API
            await apiService.deleteEvent(eventId);
            
            // Remove from local state
            events = events.filter(event => event._id !== eventId);
            
            // Update the UI
            updateDashboard();
            
            // If we're in the view-events section, reload it
            const currentSection = document.querySelector('.nav-links a.active')?.getAttribute('data-section');
            if (currentSection === 'view-events') {
                loadSection('view-events');
            }
            
            showToast('Event deleted successfully!');
            
        } catch (error) {
            console.error('Delete error:', error);
            showToast('Error deleting event: ' + error.message, true);
        }
    };

    window.answerQuestion = async function(questionId) {
        const answerInput = document.getElementById(`answer-${questionId}`);
        const answer = answerInput.value.trim();
        
        if (!answer) {
            alert('Please enter an answer before sending.');
            return;
        }

        try {
            const answerData = { answer: answer };
            await apiService.answerQuestion(questionId, answerData);
            
            showToast('Answer sent successfully!');
            
            // Reload the questions section to show updated state
            loadSection('questions');
            
        } catch (error) {
            showToast('Error sending answer: ' + error.message, true);
        }
    };

    window.contactSponsor = function() {
        showToast('Contacting Sponsor 1...');
    };

    window.copyToClipboard = function(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('Zoom link copied to clipboard!');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('Zoom link copied to clipboard!');
        });
    };

    // Start the app
    document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>